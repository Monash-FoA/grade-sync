steps:
- type: download_file
  source: "{ secrets.2022_NOV_MARK_SHEET }"
  dest: data/mark_sheet.xlsx
- type: block_file
  message: "Download Ed results: https://edstem.org/au/courses/10137/lessons/29853/slides/210596/submissions?u=186341&s=21738662 to data/ed.csv"
  path: data/ed.csv
  lifetime: 24
- type: block_dir
  message: "Download interview sheets: { secrets.2022_NOV_A2_INT_SHEETS } to data/AU and data/MA"
  path: data/AU
  lifetime: 24
- type: sheet
  path: data/mark_sheet.xlsx
  sheet: A2 Marks
  compute_scripts:
  - scripts/compute/utils.py
  - scripts/compute/feedback.py
  sections:
    id:
      type: ID
      path: data/mark_sheet.xlsx
      display: "Information"
      sheet: "Student Details"
      header_row: 1
      source: "Student ID"
      dest: "Student ID"
    info:
      type: Lookup
      path: data/mark_sheet.xlsx
      display: "Information"
      sheet: "Student Details"
      header_row: 1
      items:
        - source: "Email"
          dest: "Email"
        - source: "First Name"
          dest: "First Name"
        - source: "Last Name"
          dest: "Last Name"
        - source: "Group ID 1"
          dest: "Group ID"
        - source: "Marker A2"
          dest: "Marker"
        - source: "A2 Ed submission marked"
          dest: "Group Member Marked"
    ed:
      type: Ed
      display: Ed
      path: data/ed.csv
      criterion: configuration/ed/criteria/2022/NOV/A2.json
      sheet_lookup: Email
      grade_lookup: email
      group_mark_lookup: Group Member Marked
    interview:
      type: MultiLookup
      display: Interview
      path: data/AU/1008/\{ID[Student ID]\}.xlsx
      items:
        - source: "Interview Marks!G9"
          dest: "Interview Mark"
    comp:
      type: Computed
      display: Autogenerated
      items:
        - source: "float(ed['ed_mark'] or 0) + float(interview['Interview Mark'] or 0)"
          dest:   "Total Mark"
        - source: "gen_feedback_2022_nov_a2(O)"
          dest:   "Feedback"
- type: command
  command: python -m scripts.xml_export data/mark_sheet.xlsx 'A2 Marks' { secrets.2022_NOV_A2_ID } data/grades.xml
- type: block_confirm
  message: "Import grades from data/grades.xml to { secrets.2022_NOV_XML_UPDATE }"
