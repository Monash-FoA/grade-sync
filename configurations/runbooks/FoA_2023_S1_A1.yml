steps:
- type: require
  wait_message: "Download mark sheet: {secrets[2023_S1_MARK_SHEET]} to data/mark_sheet.xlsx"
  path: data/mark_sheet.xlsx
  lifetime: 24
- type: require
  wait_message: "Download Ed results: https://edstem.org/au/courses/10179/lessons/32500/slides/228403 to data/ed.csv"
  path: data/ed.csv
  lifetime: 24
- type: sheet
  path: data/mark_sheet.xlsx
  sheet: A1 Marks
  compute_scripts:
  - scripts/compute/utils.py
  - scripts/compute/feedback.py
  sections:
    id:
      type: ID
      path: data/mark_sheet.xlsx
      display: "Information"
      sheet: "Student Details"
      header_row: 2
      source: "Student ID"
      dest: "Student ID"
    info:
      type: Lookup
      path: data/mark_sheet.xlsx
      display: "Information"
      sheet: "Student Details"
      header_row: 2
      items:
        - source: "Email"
          dest: "Email"
        - source: "First Name"
          dest: "First Name"
        - source: "Last Name"
          dest: "Last Name"
        - source: "Campus"
          dest: "Campus"
        - source: "Marker A1"
          dest: "Marker"
        - source: "A1 Due Date"
          dest: "Due Date"
    overrides:
      type: Lookup
      path: data/mark_sheet.xlsx
      display: "Overrides"
      sheet: "Assignment Overrides"
      header_row: 2
      items:
        - source: "A1 AI Breach Multiplier"
          dest: "AI Breach Multiplier"
    ed:
      type: Ed
      display: Ed
      path: data/ed.csv
      criterion: configurations/ed/criteria/2023/S1/A1.json
      sheet_lookup: Email
      grade_lookup: email
    interview:
      type: Lookup
      path: data/mark_sheet.xlsx
      display: "Information"
      sheet: "A1 Int Mark"
      header_row: 2
      items:
        - source: "Q1"
          dest: "Q1"
        - source: "Q2"
          dest: "Q2"
        - source: "Q3"
          dest: "Q3"
        - source: "Q4"
          dest: "Q4"
        - source: "Q5"
          dest: "Q5"
        - source: "Q6"
          dest: "Q6"
        - source: "Total"
          dest: "Interview Total"
    comp:
      type: Computed
      display: Autogenerated
      items:
        - source: "utils.fix_t1_complex(ed)"
          dest:   "fix_t1_complex"
        - source: "utils.fix_total(O)"
          dest:   "fixed_ed_mark"
        - source: "utils.late_penalty(O)"
          dest:   "late_penalty"
        - source: "utils.gen_mark_2023_s1_a1(O)"
          dest:   "Total Mark"
        - source: "utils.gen_feedback_2023_s1_a1(O)"
          dest:   "Feedback"
        - source: "utils.percent_marked_a1_ed(ed)"
          dest: "PCT_ED_MARKED"
        - source: "utils.percent_marked_a1_int(interview)"
          dest: "PCT_INT_MARKED"
- type: command
  command: python -m scripts.xml_export data/mark_sheet.xlsx "A1 Marks" {secrets[2023_S1_A1_ID]} data/grades.xml
- type: confirm
  message: "Import grades from data/grades.xml to {secrets[2023_S1_XML_UPDATE]}"
