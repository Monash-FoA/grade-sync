steps:
- type: require
  wait_message: "Download mark sheet: {secrets[2023_S1_MARK_SHEET]} to data/mark_sheet.xlsx"
  path: data/mark_sheet.xlsx
  lifetime: 24
- type: require
  wait_message: "Download Ed results: https://edstem.org/au/courses/10179/lessons/34851/slides/244017/submissions to data/ed.csv"
  path: data/ed.csv
  lifetime: 24
- type: sheet
  path: data/mark_sheet.xlsx
  sheet: A3 Marks
  compute_scripts:
  - scripts/compute/utils.py
  - scripts/compute/feedback.py
  sections:
    id:
      type: ID
      path: data/mark_sheet.xlsx
      display: "Information"
      sheet: "Student Details"
      header_row: 2
      source: "Student ID"
      dest: "Student ID"
    info:
      type: Lookup
      path: data/mark_sheet.xlsx
      display: "Information"
      sheet: "Student Details"
      header_row: 2
      items:
        - source: "Email"
          dest: "Email"
        - source: "First Name"
          dest: "First Name"
        - source: "Last Name"
          dest: "Last Name"
        - source: "Campus"
          dest: "Campus"
        - source: "Marker A3"
          dest: "Marker"
        - source: "A3 Due Date"
          dest: "Due Date"
        - source: "Group ID 3"
          dest: "Group ID"
    overrides:
      type: Lookup
      path: data/mark_sheet.xlsx
      display: "Overrides"
      sheet: "Assignment Overrides"
      header_row: 2
      items:
        - source: "A3 Solo Override Bool"
          dest: "Solo Mark"
    ed:
      type: Ed
      display: Ed
      path: data/ed.csv
      criterion: configurations/ed/criteria/2023/S1/A3.json
      sheet_lookup: Email
      grade_lookup: email
      group_lookup: Group ID
    interview:
      type: Lookup
      path: data/mark_sheet.xlsx
      display: "Information"
      sheet: "A3 Interview Log"
      header_row: 2
      items:
        - source: "Q1"
          dest: "Q1"
        - source: "Q1 Feedback"
          dest: "Q1 Feedback"
        - source: "Q2"
          dest: "Q2"
        - source: "Q2 Feedback"
          dest: "Q2 Feedback"
        - source: "Q3"
          dest: "Q3"
        - source: "Q3 Feedback"
          dest: "Q3 Feedback"
        - source: "Overall Mark"
          dest: "Interview Total"
    comp:
      type: Computed
      display: Autogenerated
      items:
        - source: "utils.late_penalty(O)"
          dest:   "late_penalty"
        - source: "utils.gen_mark_2023_s1_a3(O)"
          dest:   "Total Mark"
        - source: "utils.gen_feedback_2023_s1_a3(O)"
          dest:   "Feedback"
        - source: "utils.percent_marked_a3_ed(ed)"
          dest: "PCT_ED_MARKED"
        - source: "utils.percent_marked_a3_int(interview)"
          dest: "PCT_INT_MARKED"
- type: command
  command: python -m scripts.xml_export data/mark_sheet.xlsx "A3 Marks" {secrets[2023_S1_A3_ID]} data/grades.xml
- type: confirm
  message: "Import grades from data/grades.xml to {secrets[2023_S1_XML_UPDATE]}"
