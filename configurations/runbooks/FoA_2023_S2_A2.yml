steps:
- type: require
  wait_message: "Download mark sheet: {secrets[2023_S2_MARK_SHEET]} to data/mark_sheet.xlsx"
  path: data/mark_sheet.xlsx
  lifetime: 24
- type: require
  wait_message: "Download Ed results: https://edstem.org/au/courses/12108/lessons/36774/slides/256600 to data/ed.csv"
  path: data/ed.csv
  lifetime: 24
- type: sheet
  path: data/mark_sheet.xlsx
  sheet: A2 Marks
  compute_scripts:
  - scripts/compute/utils.py
  - scripts/compute/feedback.py
  sections:
    id:
      type: ID
      path: data/mark_sheet.xlsx
      display: "Information"
      sheet: "Top Level Info"
      header_row: 2
      source: "Student ID"
      dest: "Student ID"
    info:
      type: Lookup
      path: data/mark_sheet.xlsx
      display: "Information"
      sheet: "Top Level Info"
      header_row: 2
      items:
        - source: "Email"
          dest: "Email"
        - source: "First Name"
          dest: "First Name"
        - source: "Last Name"
          dest: "Last Name"
        - source: "Unit Code"
          dest: "Unit Code"
        - source: "Campus"
          dest: "Campus"
        - source: "Marker A2"
          dest: "Marker"
        - source: "A2 Due Date"
          dest: "Due Date"
        - source: Group ID 2
          dest: Group ID
    override:
      type: Lookup
      path: data/mark_sheet.xlsx
      display: Information
      sheet: Extra Information
      header_row: 2
      items:
        - source: "Solo"
          dest: "A2 Solo"
        - source: "A2 Multiplier"
          dest: "AI Mult"
        - source: "A2 Moodle Due Date"
          dest: "Moodle Due Date"
    ed:
      type: NewEd
      display: Ed
      path: data/ed.csv
      criterion: configurations/ed/criteria/2023/S2/A2.json
      sheet_lookup: Email
      grade_lookup: EMAIL
      group_lookup: Group ID
    # TODO
    comp:
      type: Computed
      display: Autogenerated
      items:
        - source: "utils.gen_mark_2023_s2_a2(O)"
          dest: "Total Mark"
        - source: "utils.late_penalty_with_moodle_fuckery(O)"
          dest:   "late_penalty"
        - source: "utils.account_for_late_penalty(O)"
          dest: "actual_total_mark"
        - source: "utils.gen_feedback_2023_s2_a2(O)"
          dest:   "Feedback"
        - source: "utils.percent_marked_2023_s2_a2_ed(O)"
          dest: "PCT_ED_MARKED"
- type: command
  command: python -m scripts.xml_export data/mark_sheet.xlsx "A2 Marks" {secrets[2023_S2_A2_ID]} data/grades.xml -mark actual_total_mark
- type: confirm
  message: "Import grades from data/grades.xml to {secrets[2023_S2_XML_UPDATE]}"
